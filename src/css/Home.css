/* Home.css - Fantasy D&D Style */

@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Cinzel+Decorative:wght@700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.home-container {
  width: 100%;
  height: 100dvh;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  font-family: 'Cinzel', serif;
  background: #6f573c;
  background-image:
    radial-gradient(circle at 25% 25%, rgba(139, 115, 85, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(160, 149, 107, 0.3) 0%, transparent 50%);
  position: relative;
  overflow: hidden;
}

.your-quest-btn {
  background: linear-gradient(135deg, #ffeac8, #d8ba8a);
  border: 2px solid #90774c;
  color: #2F1B14;
  opacity: 0.7;
  cursor: default !important;
  pointer-events: none !important;
  margin-top: 8px;
  width: 100%;
  transition: none;
}

/* Style for the music button - base (no large negative offset anymore) */
.music-icon {
  position: relative;
  width: 45px;
  height: 45px;
  background-color: transparent;
  border: 2px solid #2F1B14;
  border-radius: 50%;
  cursor: pointer;
  padding: 0;
  overflow: hidden;
  box-sizing: border-box;
  display: flex;
  justify-content: center;
  align-items: center;
}

.music-icon img {
  width: 72%;
  height: 72%;
  object-fit: cover;
  display: flex;
}

/* replace previous pseudo-element rules with a clear behaviour:
   - default ::before is hidden
   - when NOT .playing the line is shown
   - when .playing the line is hidden */
.music-icon::before {
  content: '';
  position: absolute;
  width: 56%;
  height: 2px;
  background-color: #fff0dc;
  top: 50%;
  left: 63%;
  transform: translate(-50%, -50%) rotate(45deg);
  scale: 1.5;
  transform-origin: center;
  z-index: 2;
  display: none;
}

/* Show the strike only when NOT playing (i.e. muted/stopped) */
.music-icon:not(.playing)::before {
  display: block;
}

/* Ensure playing state removes strike and gives active visuals */
.music-icon.playing {
  border-color: #d4a017;
  transform: scale(1.1);
  box-shadow: 0 0 8px rgba(212, 160, 23, 0.6);
}

/* Hide the header's music button (the map has its own). This keeps layout clean. */
.header > .music-icon {
  display: none;
}

/* Position the music button inside the map area (top-right) */
.map-frame .music-icon,
#map > .music-icon {
  position: absolute;
  top: 18px;
  right: 18px;
  width: 60px;
  height: 60px;
  z-index: 1200; /* sit above map controls */
  border: 2px solid #fff2d8;
  border-radius: 50%;
  background-color: rgba(255, 235, 214, 0.02);
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}

/* make the icon image scale nicely inside the map button */
.map-frame .music-icon img,
#map > .music-icon img {
  width: 70%;
  height: 70%;
}

/* Mobile adjustments: smaller and slightly inset on small screens */
@media (max-width: 800px) {
  .map-frame .music-icon,
  #map > .music-icon {
    top: 12px;
    right: 20px;
    width: 60px;
    height: 60px;
  }

  /* Ensure header's music remains hidden on mobile too */
  .header > .music-icon {
    display: none;
  }

  .leaflet-control-zoom {
    margin-left: 18
    px !important;
  }

}

@media (max-width: 450px) {
  .map-frame .music-icon,
  #map > .music-icon {
    top: 10px;
    right: 18px;
    width: 58px;
    height: 58px;
  }
}

/* Abandon Quest button - updated styles */
.abandon-quest-btn {
  background: linear-gradient(135deg, #c89d5c 0%, #ffe3a1 100%);
  border: 2px solid #a97a4c;
  color: #4b2e1a;
  font-family: 'Cinzel', serif;
  font-weight: 700;
  font-size: 0.9rem;
  box-shadow: 0 4px 12px rgba(200, 157, 92, 0.18), 0 1.5px 4px rgba(0, 0, 0, 0.13);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  border-radius: 20px;
  padding: 10px 20px;
  text-transform: uppercase;
  letter-spacing: 1px;
  width: 100%;
  display: block;
}

.abandon-quest-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.22), transparent);
  transition: left 0.5s;
}

.abandon-quest-btn:hover::before {
  left: 100%;
}

.abandon-quest-btn:hover {
  background: linear-gradient(135deg, #e6b96a 0%, #fff2c9 100%);
  border-color: #a97a4c;
  color: #3a230a;
  transform: translateY(-2px);
  box-shadow: 0 9px 20px rgba(200, 157, 92, 0.22);
}

.abandon-quest-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.23);
}

.home-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23654321' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 1;
}



/* Header Styles */
.header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 30px;
  z-index: 100;
}

/* Website Name with Logo - Updated to match create quest button */
.website-name {
  background: linear-gradient(135deg, #ffeac8, #d8ba8a);
  border: 2px solid #90774c;
  border-radius: 25px;
  padding: 8px 25px;
  box-shadow:
    0 8px 25px rgba(144, 119, 76, 0.4),
    0 4px 15px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
}

.website-name::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: #90774c;
  border-radius: 27px;
  z-index: -1;
}

.website-name::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.5s;
}

.logo {
  width: 60px;
  height: 60px;
  object-fit: contain;
  flex-shrink: 0;
}

.website-name h1 {
  font-family: 'Cinzel Decorative', serif;
  font-size: 22px;
  font-weight: 700;
  color: #2F1B14;
  letter-spacing: 2px;
  margin: 0;
  text-shadow: 1px 1px 2px rgba(47, 27, 20, 0.3);
}

/* User Area - Updated to match create quest button */
.user-area {
  background: linear-gradient(135deg, #ffeac8, #d8ba8a);
  border: 2px solid #90774c;
  border-radius: 25px;
  padding: 12px 25px;
  min-width: 220px;
  box-shadow:
    0 8px 25px rgba(144, 119, 76, 0.4),
    0 4px 15px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  position: relative;
  overflow: hidden;
}

/* Authentication Buttons */
.auth-buttons {
  display: flex;
  gap: 15px;
  align-items: center;
  justify-content: center;
}

.signup-btn,
.login-btn {
  padding: 10px 20px;
  border: 2px solid #90774c;
  border-radius: 20px;
  font-family: 'Cinzel', serif;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.signup-btn {
  background: rgba(255, 234, 200, 0.8);
  color: #2F1B14;
}

.signup-btn:hover {
  background: linear-gradient(145deg, #473925, #846d4c);
  color: #F4E4BC;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(144, 119, 76, 0.3);
}

.login-btn {
  background: linear-gradient(145deg, #473925, #846d4c);
  color: #F4E4BC;
}

.login-btn:hover {
  background: linear-gradient(145deg, #594733, #a58d73);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(144, 119, 76, 0.3);
}

/* User Profile */
.user-profile {
  display: flex;
  align-items: center;
  gap: 15px;
  justify-content: center;
}

.profile-icon {
  /* keep existing background/spacing — do not override */
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;

  /* fantasy brown circular frame - increased size */
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 5px solid #90774c;
  /* fantasy brown */
  box-shadow:
    0 8px 16px rgba(0, 0, 0, 0.22),
    inset 0 3px 0 rgba(255, 255, 255, 0.06);
  padding: 0;
  background-clip: padding-box;
  /* keep user-area background visible */
}

.profile-icon-img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  display: block;
}

/* smaller devices */
@media (max-width: 480px) {
  .profile-icon {
    width: 48px;
    height: 48px;
    border-width: 4px;
  }

  .profile-icon-img {
    width: 100%;
    height: 100%;
  }
}

.username {
  font-family: 'Cinzel', serif;
  font-size: 16px;
  font-weight: 500;
  color: #2F1B14;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.logout-btn {
  padding: 8px 16px;
  background: linear-gradient(145deg, #473925, #846d4c);
  color: #F4E4BC;
  border: 2px solid #90774c;
  border-radius: 15px;
  font-family: 'Cinzel', serif;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;

  /* enable shine effect */
  position: relative;
  overflow: hidden;
}

.logout-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.22), transparent);
  transition: left 0.4s;
}

.logout-btn:hover::before {
  left: 100%;
}

.logout-btn:hover {
  background: linear-gradient(145deg, #594733, #a58d73);
  transform: translateY(-1px);
}


/* Map Section */
.map-section {
  flex: 1;
  display: flex;
  align-items: stretch;
  /* fill vertical space */
  justify-content: center;
  padding: var(--header-offset, 120px) 30px 20px;
  width: 100%;
  position: relative;
  min-height: calc(100dvh - var(--header-offset, 120px));
  /* remove fixed height dependency */
}

.map-container {
  width: calc(100% - 60px); /* account for the page's 30px horizontal padding each side */
  max-width: none;          /* remove fixed cap so it grows with viewport */
  margin: 0 30px;           /* keep the visual horizontal padding */
  flex: 1;
  height: 100%;
  position: relative;
  min-height: 0;
  box-sizing: border-box;   /* ensure padding/border don't create overflow */
}

/* ensure map-frame still uses full container */
.map-frame {
  width: 100%;
  height: 100%;
  position: relative;
  background: linear-gradient(145deg, #D2B48C, #DEB887);
  /* Remove border, use pseudo-element for animated border */
  border-radius: 20px;
  padding: 15px;
  box-shadow:
    0 0 0 3px #b48e65,
    0 20px 40px rgba(101, 67, 33, 0.5),
    0 30px 25px rgba(0, 0, 0, 0.5),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
  overflow: hidden; /* Keep this to clip any excess */
  min-height: 400px; /* NEW: Match #map's min-height to prevent frame from shrinking too small */
}

@property --angle {
  syntax: "<angle>";
  initial-value: 0deg;
  inherits: false;
}

.map-frame::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  pointer-events: none;
  border-radius: 20px;
  padding: 4px;
  box-sizing: border-box;
  background: conic-gradient(from var(--angle), #b48e65, #d4a017, #ff4545, #00ff99, #006aff, #ff0095, #b48e65);
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box, 
    linear-gradient(#fff 0 0);
  mask:
    linear-gradient(#fff 0 0) content-box, 
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  animation: spin 3s linear infinite;
}

/* Remove the animated rainbow gradient border around the map frame */
.map-frame::before,
.map-frame::after {
  content: none !important;
  animation: none !important;
  background: none !important;
  filter: none !important;
}

.map-frame::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  pointer-events: none;
  border-radius: 20px;
  padding: 4px;
  box-sizing: border-box;
  background: conic-gradient(from var(--angle), #b48e65, #d4a017, #ff4545, #00ff99, #006aff, #ff0095, #b48e65);
  filter: blur(1.5rem);
  opacity: 0.4;
  animation: spin 3s linear infinite;
}

@keyframes spin {
  from {
    --angle: 0deg;
  }
  to {
    --angle: 360deg;
  }
}
/* small safeguard for very small screens (keeps existing mobile rules intact) */
@media (max-width: 800px) {
  .map-container {
    width: calc(100% + 60px); /* mobile override (already used elsewhere) */
    margin: 0 -30px -20px -30px;
    
  }

  .map-frame {
    /* ...existing code... */
    overflow: hidden; /* Ensure overflow is hidden on mobile too */
    min-height: 340px; /* NEW: Match the adjusted #map min-height for mobile */
  }

  /* ...existing code... */
}

.map-corners {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 10;
}

.corner {
  position: absolute;
  width: 40px;
  height: 40px;
  background: radial-gradient(circle, #ab855f 30%, transparent 30%);
}

.corner.top-left {
  top: 10px;
  left: 10px;
}

.corner.top-right {
  top: 10px;
  right: 10px;
}

.corner.bottom-left {
  bottom: 10px;
  left: 10px;
}

.corner.bottom-right {
  bottom: 10px;
  right: 10px;
}

#map {
  width: 100%;
  height: 100%;
  min-height: 320px;
  /* was 400px */
  border-radius: 10px;
  overflow: hidden;
  position: relative;
  z-index: 1;
  /* Updated filter for light brown buildings */
  filter: sepia(0.55) saturate(1) contrast(1) brightness(1);
  /* Ensure minimum height */
  min-height: 400px;
  max-height: 100%;  /* Added to prevent #map from exceeding its parent's height, reducing overflow risk */
}

/* Fix Leaflet container issues */
.leaflet-container {
  width: 100% !important;
  height: 100% !important;
  border-radius: 10px;
  background-color: #F4E4BC !important;
  /* Fantasy parchment background */
}

/* Ensure map tiles load properly */
.leaflet-tile-pane {
  filter: inherit;
}

/* Custom Leaflet Controls */
.leaflet-control-zoom {
  border: none !important;
  box-shadow: none !important;
  margin-top: 25px !important;
}

.leaflet-control-zoom a {
  background: linear-gradient(145deg, #F4E4BC, #E6D5A8) !important;
  border: 2px solid #654321 !important;
  color: #654321 !important;
  font-family: 'Cinzel', serif !important;
  font-weight: bold !important;
  border-radius: 12px !important;
  margin-top: 5px;
  box-shadow: 0 2px 8px rgba(101, 67, 33, 0.3) !important;
}

.leaflet-control-zoom a:hover {
  background: linear-gradient(145deg, #E6D5A8, #D2B48C) !important;
  transform: translateY(-1px);
}

/* Custom Fantasy Marker */
.fantasy-marker {
  background: none !important;
  border: none !important;
}

.fantasy-marker-content {
  position: relative;
  width: 30px;
  height: 40px;
}

.marker-pin {
  width: 20px;
  height: 30px;
  background: linear-gradient(145deg, #705434, #6c5949);
  border: 2px solid #654321;
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg);
  position: absolute;
  top: 0;
  left: 5px;
  box-shadow: 0 3px 10px rgba(101, 67, 33, 0.4);
}

.marker-pin::after {
  content: '🏰';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(45deg);
  font-size: 12px;
}

.marker-pulse {
  width: 30px;
  height: 30px;
  border: 3px solid #654321;
  border-radius: 50%;
  position: absolute;
  top: 0;
  left: 0;
  animation: fantasy-pulse 2s infinite;
  opacity: 0.7;
}

@keyframes fantasy-pulse {
  0% {
    transform: scale(0.8);
    opacity: 1;
  }

  50% {
    transform: scale(1.2);
    opacity: 0.5;
  }

  100% {
    transform: scale(0.8);
    opacity: 1;
  }
}

/* Fantasy Popup */
.leaflet-popup-content-wrapper {
  background: linear-gradient(145deg, #F4E4BC, #E6D5A8) !important;
  border: 3px solid #654321 !important;
  border-radius: 15px !important;
  box-shadow: 0 8px 25px rgba(101, 67, 33, 0.4) !important;
}

.fantasy-popup h3 {
  font-family: 'Cinzel Decorative', serif !important;
  color: #654321;
  margin: 0 0 8px 0;
  text-align: center;
  letter-spacing: 1px;
}

.fantasy-popup p {
  font-family: 'Cinzel', serif;
  color: #8B4513;
  margin: 0;
  text-align: center;
  font-style: italic;
}

/* Add this to ensure popup text uses same emoji font */
.quest-popup h3 {
  font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", "EmojiSymbols", "EmojiOne Mozilla", "Twemoji Mozilla", "Segoe UI Symbol", sans-serif;
}

.leaflet-popup-tip {
  background: #E6D5A8 !important;
  border: 3px solid #654321 !important;
}

.quest-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: linear-gradient(145deg, #fff2c9, #ffd27a);
  color: #4b2e1a;
  border: 2px solid #4b2e1a;
  padding: 4px 8px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 0.75rem;
  margin-bottom: 8px;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(75, 46, 26, 0.18);
}

.quest-badge .badge-text {
  margin-left: 2px;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.5px;
}


/* Questbook Icon */
.questbook-icon {
  position: absolute;
  bottom: 15px;
  right: 15px;
  background: transparent;
  /* Remove background */
  border: none;
  /* Remove border */
  width: 100px;
  /* Increased from 80px */
  height: 100px;
  /* Increased from 80px */
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  z-index: 1000;
  /* Remove box-shadow */
}

.questbook-icon::before {
  display: none;
  /* Remove the circle background */
}

.questbook-icon:hover {
  transform: scale(1.1) translateY(-3px);
  /* Remove box-shadow on hover */
}

.questbook-icon img {
  width: 70px;
  /* Increased from 45px */
  height: 70px;
  /* Increased from 45px */
  object-fit: contain;
  /* Remove filter for cleaner PNG appearance */
  filter: none;
}

/* Quest Circle Animations - Updated to remove movement */
.quest-circle {
  animation: quest-pulse-static 3s ease-in-out infinite;
}

@keyframes quest-pulse-static {

  0%,
  100% {
    opacity: 0.7;
  }

  50% {
    opacity: 0.5;
  }
}

/* Quest Popup Styling */
.quest-popup {
  text-align: center;
  font-family: 'Cinzel', serif;
  font-size: 0.85rem;
  max-width: 200px;
}

.quest-popup h3 {
  color: #654321;
  margin: 8px 0;
  font-size: 1rem;
  font-weight: 600;
  /* Update font to match the decorative header style */
  font-family: 'Cinzel Decorative', serif !important;
  letter-spacing: 1px;
}

/* Fantasy Popup (for Wits University marker) */
.fantasy-popup h3 {
  font-family: 'Cinzel Decorative', serif !important;
  color: #654321;
  margin: 0 0 8px 0;
  text-align: center;
  letter-spacing: 1px;
}

.fantasy-popup p {
  font-family: 'Cinzel', serif;
  color: #8B4513;
  margin: 0;
  text-align: center;
  font-style: italic;
}

/* Add this to ensure popup text uses same emoji font */
.quest-popup h3 {
  font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", "EmojiSymbols", "EmojiOne Mozilla", "Twemoji Mozilla", "Segoe UI Symbol", sans-serif;
}

.leaflet-popup-tip {
  background: #E6D5A8 !important;
  border: 3px solid #654321 !important;
}

/* Questbook Icon */
.questbook-icon {
  position: absolute;
  bottom: 15px;
  right: 15px;
  background: transparent;
  /* Remove background */
  border: none;
  /* Remove border */
  width: 100px;
  /* Increased from 80px */
  height: 100px;
  /* Increased from 80px */
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  z-index: 1000;
  /* Remove box-shadow */
}

.questbook-icon::before {
  display: none;
  /* Remove the circle background */
}

.questbook-icon:hover {
  transform: scale(1.1) translateY(-3px);
  /* Remove box-shadow on hover */
}

.questbook-icon img {
  width: 70px;
  /* Increased from 45px */
  height: 70px;
  /* Increased from 45px */
  object-fit: contain;
  /* Remove filter for cleaner PNG appearance */
  filter: none;
}

/* Create Quest Button */
.create-quest-btn {
  background: linear-gradient(135deg, #ffeac8, #d8ba8a);
  border: 2px solid #90774c;
  color: #2F1B14;
  font-family: 'Cinzel', serif;
  font-weight: 600;
  font-size: 0.9rem;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  position: relative;
  overflow: hidden;
}

.create-quest-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.5s;
}

.create-quest-btn:hover::before {
  left: 100%;
}

.create-quest-btn:hover {
  background: linear-gradient(135deg, #ffe8c4, #dbbc89);
  border-color: #90774c;
  transform: translateY(-2px);
  box-shadow: 0 9px 20px rgba(49, 39, 31, 0.9);
}

.create-quest-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Accept Quest Button */
.quest-accept-btn {
  background: linear-gradient(135deg, #473925, #846d4c);
  border: 2px solid #46392a;
  color: white;
  cursor: pointer;
}

.quest-accept-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.4s;
}

.quest-accept-btn:hover::before {
  left: 100%;
}

.quest-accept-btn:hover {
  background: linear-gradient(135deg, #594733, #a58d73);
  border-color: #443626;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

.quest-accept-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* Quest Popup Styling */
.quest-popup {
  text-align: center;
  font-family: 'Cinzel', serif;
  font-size: 0.85rem;
  max-width: 200px;
}

.quest-popup h3 {
  color: #654321;
  margin: 8px 0;
  font-size: 1rem;
  font-weight: 600;
  font-family: 'Cinzel Decorative', serif !important;
  letter-spacing: 1px;
}

.quest-popup p {
  font-size: 0.8rem;
  margin: 6px 0;
}

.quest-image-container {
  margin: 8px 0;
  max-height: 100px;
  border-radius: 6px;
  overflow: hidden;
}

.quest-popup-image {
  width: 100%;
  height: auto;
  max-height: 100px;
  object-fit: cover;
  display: block;
  border: 3px solid #4b2e1a;
  /* dark oak brown */
  border-radius: 6px;
  box-shadow: 0 4px 8px rgba(75, 46, 26, 0.35);
}


/* Fantasy Popup (for Wits University marker) */
.fantasy-popup h3 {
  font-family: 'Cinzel Decorative', serif !important;
  color: #654321;
  margin: 0 0 8px 0;
  text-align: center;
  letter-spacing: 1px;
}

.fantasy-popup p {
  font-family: 'Cinzel', serif;
  color: #8B4513;
  margin: 0;
  text-align: center;
  font-style: italic;
}

/* Quest Emoji Icon Styles */
.quest-emoji-icon {
  background: transparent;
  width: 30px;
  height: 30px;
}

.quest-emoji-icon .quest-emoji {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: 21px;
  line-height: 1;
  transform: translateY(1px);
  user-select: none;
  filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.55));
  font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", "EmojiSymbols", "EmojiOne Mozilla", "Twemoji Mozilla", "Segoe UI Symbol", sans-serif;
}

.quest-placing .quest-emoji-icon {
  pointer-events: none !important;
}

/* Mobile: site title on top, create + user side-by-side, trimmed to content & map pulled up */
@media (max-width: 800px) {
  .header {
    /* use grid so we can put site title full-width and controls on one row below */
    display: grid;
    grid-template-columns: auto auto;
    grid-auto-rows: auto;
    gap: 10px;
    justify-content: center;
    align-items: center;
    padding: 12px 16px;
    left: 0;
    right: 0;
    top: 0;
  }

  /* site title spans full width and remains centered */
  .website-name {
    grid-column: 1 / -1;
    justify-self: center;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px;
    width: auto;
    max-width: calc(100% - 40px);
  }

  .website-name h1 {
    font-size: 18px;
  }

  /* put Create and User in the two columns under the title, trimmed to content and centered as a group */
  .create-quest-btn {
    grid-column: 1 / 2;
    justify-self: end;
    display: inline-flex;
    align-items: center;
    padding: 8px 12px;
    width: auto;
    box-sizing: border-box;
    margin: 0;
  }

  .user-area {
    grid-column: 2 / 3;
    justify-self: start;
    display: inline-flex;
    align-items: center;
    padding: 6px 10px;
    width: auto;
    min-width: 0;
    box-sizing: border-box;
  }

  /* tighten gaps for small screens */
  .auth-buttons,
  .user-profile {
    gap: 8px;
  }

  .signup-btn,
  .login-btn,
  .logout-btn {
    padding: 7px 10px;
    font-size: 13px;
  }

  .profile-icon {
    width: 36px;
    height: 36px;
    font-size: 15px;
  }

  .username {
    font-size: 14px;
    margin-left: 8px;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    max-width: 120px;
  }

  /* pull map up by reducing the padding-top used by the map section on mobile */
  .map-section {
    /* nudge the map slightly lower on mobile (was -40px) */
    padding-top: calc(var(--header-offset, 120px) - 20px);
    /* remove horizontal and bottom padding so map may reach edges */
    padding-left: 0;
    padding-right: 0;
    padding-bottom: 0;
  }

  /* Stretch the map to the left/right and bottom edges while keeping the decorative border:
     - remove the container max-width so it can span full viewport
     - expand the container width by the original horizontal padding (30px each side),
       then pull it back using negative margins so the map-frame border sits at the viewport edge
     - remove the small bottom spacing so the frame reaches the bottom */
  .map-container {
    max-width: none;
    width: calc(100% + 60px); /* original horizontal padding was 30px each side */
    margin: 0 -30px -20px -30px; /* pull left/right to screen edges, reduce bottom gap */
    min-height: calc(100dvh - var(--header-offset, 120px));
  }

  .map-frame {
    /* Keep the visual border but ensure it uses box-sizing so padding doesn't add overflow */
    box-sizing: border-box;
    padding: 12px; /* slightly reduce inner padding on mobile */
    border-radius: 12px; /* keep decorative corners */
    width: 100%;
    height: 100%;
  }

  /* reduce map min-height slightly for mobile space */
  #map {
    min-height: 340px;
  }

  /* Mobile-specific override so the music icon is visible and centered.
     This removes the large negative left offset from desktop styles and
     places the music button on its own row centered under the title. */
  .music-icon {
    grid-column: 1 / -1;
    justify-self: center;
    margin: 6px 0;
    width: 40px;
    height: 40px;
    align-self: center;
    /* make sure it sits above other header elements */
    z-index: 250;
    /* remove pointer blocking from prior rules on mobile */
    cursor: pointer;
    pointer-events: auto;
  }

  /* small adjustments to prevent header controls from colliding */
  .create-quest-btn,
  .user-area {
    margin-top: 0;
    margin-bottom: 0;
  }
}

/* Extra small screens */
@media (max-width: 450px) {
  .website-name h1 {
    font-size: 16px;
  }

  .logo {
    width: 44px;
    height: 44px;
  }

  .create-quest-btn {
    font-size: 0.85rem;
    padding: 7px 10px;
  }

  .username {
    display: none;
  }

  /* ensure music icon remains visible and slightly smaller on very small screens */
  .music-icon {
    width: 34px;
    height: 34px;
    margin: 6px 0;
    grid-column: 1 / -1;
    justify-self: center;
  }

  /* on very small screens keep the map flush but reduce the negative margin used above */
  .map-container {
    width: calc(100% + 40px);
    margin-left: -20px;
    margin-right: -20px;
    margin-bottom: -10px;
  }

  /* hide username if space is too small */
}

/* Make questbook and bell icons slightly smaller on mobile so they don't dominate the map
   (force with !important so other rules don't override) */
@media (max-width: 800px) {
  .questbook-icon {
    width: 84px !important;
    height: 84px !important;
    bottom: 12px !important;
    right: 12px !important;
  }

  .questbook-icon img {
    width: 56px !important;
    height: 56px !important;
  }

  .bell-icon {
    width: 84px !important;
    height: 84px !important;
    bottom: 12px !important;
    left: 12px !important;
  }

  .bell-icon img {
    width: 56px !important;
    height: 56px !important;
  }
}

/* Extra-small screens — force smaller sizes */
@media (max-width: 480px) {
  .questbook-icon {
    width: 80px !important;
    height: 80px !important;
    bottom: 10px !important;
    right: 10px !important;
  }

  .questbook-icon img {
    width: 58px !important;
    height: 58px !important;
  }

  .bell-icon {
    width: 80px !important;
    height: 80px !important;
    bottom: 10px !important;
    left: 10px !important;
  }

  .bell-icon img {
    width: 58px !important;
    height: 58px !important;
  }
}

.quest-popup-btn {
  font-family: 'Cinzel', serif;
  font-weight: 600;
  font-size: 0.8rem;
  padding: 6px 12px;
  border-radius: 14px;
  width: 100%;
  margin-top: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  display: block;
}

.bell-icon {
  position: absolute;
  bottom: 15px;
  left: 15px;
  background: transparent;
  border: none;
  width: 100px;
  height: 100px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  z-index: 1000;
}

.bell-icon:hover {
  transform: scale(1.1) translateY(-3px);
}

.bell-icon img {
  width: 70px;
  height: 70px;
  object-fit: contain;
  filter: none;
}

/* Bell active / ringing visuals */
.bell-icon.playing {
  border-color: #d4a017;
  transform: scale(1.06);
  box-shadow: 0 8px 22px rgba(212,160,23,0.18);
  background: rgba(212,160,23,0.04);
}

/* make the bell image pop when active */
.bell-icon.playing img {
  filter: drop-shadow(0 6px 12px rgba(212,160,23,0.18));
  transform: translateY(-1px);
}

/* small pulse ring (subtle) while active */
.bell-icon.playing::after {
  content: '';
  position: absolute;
  width: 110%;
  height: 110%;
  border-radius: 50%;
  top: -5%;
  left: -5%;
  box-shadow: 0 0 0 2px rgba(212,160,23,0.06);
  animation: bell-pulse 1000ms ease-out 1;
  pointer-events: none;
  z-index: 999;
}

@keyframes bell-pulse {
  0% { transform: scale(0.9); opacity: 0.6; }
  60% { transform: scale(1.06); opacity: 0.22; }
  100% { transform: scale(1.12); opacity: 0; }
}

/* ensure mobile size rules still apply and the playing state scales correctly */
@media (max-width: 800px) {
  .bell-icon.playing { transform: scale(1.03); box-shadow: 0 6px 16px rgba(212,160,23,0.14); }
}

@media (max-width: 480px) {
  .bell-icon.playing { transform: scale(1.02); }
}

/* Toast - compact & mobile-friendly */
.fantasy-toast {
  position: fixed;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(47, 27, 20, 0.95);
  color: #fff8ea;
  padding: 8px 12px;
  font-size: 14px;
  line-height: 1;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  z-index: 1400;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  max-width: calc(100% - 32px);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  box-sizing: border-box;
}

/* small decorative bell indicator inside toast */
.toast-bell {
  width: 16px;
  height: 16px;
  min-width: 16px;
  border-radius: 50%;
  background: linear-gradient(180deg, #ffd38a, #d4a017);
  box-shadow: 0 1px 3px rgba(0,0,0,0.25) inset;
  display: inline-block;
}

/* Mobile tweaks to reduce padding and prevent awkward wrapping/padding on small screens */
@media (max-width: 480px) {
  .fantasy-toast {
    bottom: 12px;
    padding: 6px 10px;
    font-size: 13px;
    gap: 6px;
    border-radius: 8px;
    max-width: calc(100% - 20px);
  }

  .toast-bell {
    width: 14px;
    height: 14px;
    min-width: 14px;
  }
}

/* Desktop: reduce horizontal gutters so the map frame fills more of the viewport
   without changing any mobile rules (mobile still handled by max-width:800px media queries) */
@media (min-width: 801px) {
  /* Pull the page padding in a bit so the map border sits closer to the viewport edges */
  .map-section {
    padding-left: 16px;
    padding-right: 16px;
  }

  /* Narrow the outer container margins so the framed map grows horizontally */
  .map-container {
    width: calc(100% - 32px); /* match the smaller horizontal padding */
    margin: 0 16px;
    box-sizing: border-box;
  }

  /* Slightly reduce inner frame padding so the visible map area increases while keeping the decorative border */
  .map-frame {
    padding: 12px;
    border-radius: 18px;
  }

  /* Encourage the actual map to occupy more vertical space on desktop */
  #map {
    min-height: calc(100dvh - var(--header-offset, 120px) - 24px);
  }
}

/* NEW: Tutorial Icon - positioned in top left of map */
.tutorial-icon {
  position: absolute;
  top: 18px;
  left: 32px;
  background: transparent;
  border: none;
  width: 85px;
  height: 85px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  z-index: 1000;
}

.tutorial-icon:hover {
  transform: scale(1.1) translateY(-3px);
}

.tutorial-icon img {
  width: 70%;
  height: 70%;
  object-fit: contain;
  filter: none;
}

/* Mobile adjustments */
@media (max-width: 800px) {
  .tutorial-icon {
    width: 70px;
    height: 70px;
    top: 26px;
    left: 34px;
  }

  .tutorial-icon img {
    width: 70%;
    height: 70%;
  }
}

@media (max-width: 480px) {
  .tutorial-icon {
    width: 64px;
    height: 64px;
    top: 27px;
    left: 30px;
  }

  .tutorial-icon img {
    width: 70%;
    height: 70%;
  }
}
